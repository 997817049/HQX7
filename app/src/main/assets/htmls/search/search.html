<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="../../files/public/search.css" type="text/css" rel="stylesheet"/>
    <link href="../../files/base/base.css" type="text/css" rel="stylesheet">
    <link href="../../files/study/exam/subExam.css" type="text/css" rel="stylesheet"/>
    <link href="../../files/study/book/subBook.css" type="text/css" rel="stylesheet"/>
    <link href="../../files/study/video/subTV.css" type="text/css" rel="stylesheet"/>
    <link href="../../files/public/other.css" type="text/css" rel="stylesheet">
    <link href="../../files/icon/iconfont.css" type="text/css" rel="stylesheet"/>
    <link href="../../files/main/styles.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="../../resources/scripts/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../../resources/scripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../files/public/public.js"></script>
    <script type="text/javascript" src="../../files/public/readContent.js"></script>
    <script type="text/javascript" src="../../resources/scripts/layer/layer.js"></script>
    <script type="text/javascript" src="../../resources/scripts/common.js"></script>
</head>
<style type="text/css">
    * {
        margin: 0;
        padding: 0;
        -webkit-touch-callout:none;
        -webkit-user-select:none;
        -webkit-tap-highlight-color:transparent;
    }
    body{background-color: white}
    ul{list-style-type: none}
    a {text-decoration: none;color: #18B4FE;}
    .imgtop {width: 100%;}

    .header{
        z-index: 9990;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        line-height: 16px;
        padding-top: 0px;
        text-align: center;
        background-color: white;
    }
    .header .btn-left{
        position: absolute;
        top: 11px;
        left: 0;
        padding:0px 11px;
    }
    .header input{
        position: absolute;
        top: 8px;
        left: 20%;
        width: 60%;
        padding:6px 0;
        border: 0px solid #18B4FE;
        border-radius: 8px;
        text-align: center;
        outline:none;
        -webkit-appearance: none;
    }
    .header .btn-right{
        position: absolute;
        top: 14px;
        right: 0;
        padding:0px 10px;
    }
    .header .tip{
        margin-top: 4px;
        font-size: 12px;
        color: gray;
    }
    /*菜单*/
    .header .nav{
        margin-top: 8px;
        border-bottom: 1px solid #ddd;
    }
    .header .nav p{
        display: inline-block;
        width: 17%;
        padding: 5px 0;
    }
    .header .nav .active{
        border-bottom: 2px solid #FF6990;
        color: #FF6990;
    }
    /*列表*/
    .mescroll{
        position: fixed;
        top: 84px;
        bottom: 0;
        height: auto;
    }
    /*展示上拉加载的数据列表*/
    .data-list li{
        position: relative;
        padding: 10px 8px 10px 10px;
        border-bottom: 1px solid #eee;
    }
    .data-list .pd-img{
        position: absolute;
        left: 18px;
        top: 18px;
        width: 80px;
        height: 80px;
    }
    .data-list .pd-name{
        font-size: 16px;
        line-height: 20px;
        height: 40px;
        overflow: hidden;
    }
    .data-list .pd-price{
        margin-top: 8px;
        color: red;
    }
    .data-list .pd-sold{
        font-size: 12px;
        margin-top: 8px;
        color: gray;
    }

    .footSpan{
        display: inline-block;
        width: 17%;
        padding: 0 0;
    }
    .footImg{
        display: inline-block;
        width: 11%;
        padding: 0 3%;
    }
    /*隐藏*/
    .hide{display: none;}
</style>
<body>
<div class="search-bar">
    <span class="icon iconback"  style="float: left;font-size:23px;height:38px;line-height: 38px; display: inline-block" onclick="finish()"></span>
    <button class="search-button" onclick="dealSearch()" >搜索</button>
    <input id="input" type="text" placeholder="请输入关键词" name="search" class="search-input" >
</div>
<div id="word-model" style="display:block">
    <div id="hotWord-model" class="search-model">
    </div>
    <div class="history-model">
        <div class="search-history-wrapper">
            <div class="search-history">历史记录</div>
            <div class="search-clear" onclick="clearHistoryWord()">全部清除</div>
        </div>
        <div id="history-word">
        </div>
    </div>
</div>
<div id="content" style="display: block">
    <div id="exam-content-wrapper" style="display: none">
        <div id="exam-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('study', 'exam')">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="book-content-wrapper"  style="display: none">
        <div id="book-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('study', 'book')">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="teleplay-content-wrapper"  style="display: none">
        <div id="teleplay-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('study', 'teleplay')">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="film-content-wrapper"  style="display: none">
        <div id="film-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('study', 'film')">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="variety-content-wrapper"  style="display: none">
        <div id="variety-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('study', 'variety')">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="documentary-content-wrapper"  style="display: none">
        <div id="documentary-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('study', 'documentary')">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="drama-content-wrapper"  style="display: none">
        <div id="drama-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('study', 'drama')">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="base-content-wrapper"  style="display: none">
        <div id="base-content" style="width: 100%;"></div>
        <div class="more" onclick="getMore('base', null)">查看更多</div>
        <div class="line-wrapper" style="display: block">
            <div class="dashed_line"></div>
            <div class="line_txt">我是一条分割线</div>
        </div>
    </div>
    <div id="articles"  style="display: none"></div>
</div>
</body>
<script>
    wordArr = null; //历史查找词汇
    word = null;//正在查找词汇
    isExist = false;

    var userId = window.android.getUserId();

    init();
    function init() {
        $.when(
            //加载热点词汇
            $.ajax({
                url: serverIp + "search/hotword",
                type:"POST",
                data:{
                    userId:userId
                },

                success:function (result) {
                    if(result.code === 1) {
                        console.log("从服务器获取数据失败");
                        return;
                    }
                    result = result.data;
                    $("#hotWord-model").html('');
                    for(var i = 0; i < result.length; i++) {
                        $("#hotWord-model").append(
                            '<div class="word" onclick="searchExistWord(\'' + result[i] +  '\')">' + result[i] + '</div>');
                    }
                },
                error : function () {
                }
            }),
            //加载历史搜索词汇
            $.ajax({
                url: serverIp + "search/history_word",
                type:"POST",
                data:{
                    userId:userId
                },

                success:function (result) {
                    if(result.code === 1) {
                        console.log("从服务器获取数据失败");
                        return;
                    }
                    result = result.data;
                    wordArr = result;
                    $("#history-word").html('');
                    if(result.length <= 0) {
                        $(".history-model").hide();
                        return;
                    }
                    for(var i = result.length - 1; i >= 0; i--) {
                        $("#history-word").prepend(
                            '<div id="' + result[i] + '" class="history-word" onclick="searchExistWord(\'' + result[i] +  '\')">' + result[i] + '</div>');
                    }
                },
                error : function () {
                }
            })
        ).then(function (value) {
        },function (reason) {
            return;
        });
    }

    function clearHistoryWord() {
        wordArr = new Array();
        $("#history-word").html('');
        $(".history-model").hide();
        //删除数据库中的查找历史
        $.ajax({
            url: serverIp + "delete/history_word",
            type:"POST",
            data:{
                userId:userId
            },

            success:function (result) {
                if(result.code === 1) {
                    console.log("从服务器获取数据失败");
                    return;
                }
            },
            error : function () {}
        })
    }

    function dealSearch() {
        $(".history-model").show();
        word = $(".search-input").val();
        //判断word是否存在
        var index = wordArr.indexOf(word);
        if(index !== -1){
            wordArr.splice(index, 1);
            $("#" + word).hide();
        }
        wordArr.push(word);
        if(wordArr.length>5){
            var first = wordArr.shift();
            $("#" + first).hide();
        }
        if(word === undefined || word === null || word.toString().trim().length <= 0) return;
        $("#history-word").prepend(
            '<div id="' + word + '" class="history-word" onclick="searchExistWord(\'' + word +  '\')">' + word + '</div>');
        search(word);
    }

    function searchExistWord(word) {
        $(".search-input").val(word);
        dealSearch();
    }

    function search() {
        layer.msg('&nbsp;&nbsp;正在搜索', {
            icon: 16,
            shade: 0.3,
            time: 100000
        });
        $("#word-model").hide();
        $("#exam-content-wrapper").hide();
        $("#book-content-wrapper").hide();
        $("#teleplay-content-wrapper").hide();
        $("#film-content-wrapper").hide();
        $("#variety-content-wrapper").hide();
        $("#documentary-content-wrapper").hide();
        $("#drama-content-wrapper").hide();
        $("#base-content-wrapper").hide();
        $("#articles").hide();
        searchBase();
        searchExam();
        searchBook();
        searchVideo("teleplay");
        searchVideo("film");
        searchVideo("variety");
        searchVideo("documentary");
        searchVideo("drama");
        searchArticles();
    }

    function searchBase() {
        $.ajax({
            url: serverIp + "search",
            type:"POST",
            data:{
                userId:userId,
                word:word,
                model:"base",
                part:null,
                num:0,
                limit:3
            },

            success:function (result) {
                layer.closeAll();
                if(result.code === 1) {
                    console.log("从服务器获取数据失败");
                    return;
                }
                result = JSON.parse(result.data);
                if(result.length === 0) return;
                $("#base-content").html('');
                for(var i = 0; i < result.length; i++) {
                    $("#base-content").append(
                        '<div class="base" onclick="readBase(\'' + result[i].htmlUrl + '\',\'' + result[i].id + '\')">' +
                        '<img src="'+ result[i].picUrl +'" class="base_image"/>' +
                        '<span class="base_title">' + result[i].title + '</span>' +
                        '</div>');
                }
                $("#base-content-wrapper").show();
            },
            error : function () {
                layer.closeAll();
                layer.msg("请检查网络");
            }
        })
    }

    function searchExam() {
        $.ajax({
            url: serverIp + "search",
            type:"POST",
            data:{
                userId:userId,
                word:word,
                model:"study",
                part:"exam",
                num:0,
                limit:3
            },

            success:function (result) {
                layer.closeAll();
                if(result.code === 1) {
                    console.log("从服务器获取数据失败");
                    return;
                }
                result = JSON.parse(result.data);
                if(result.length === 0)return;
                $("#exam-content").html('');
                for (var i = 0; i < result.length; i++) {
                    $("#exam-content").append(
                        '<div class="exam-wrapper"onclick="readExam(\'' + result[i].id + '\')">\n' +
                        '<span class="exam-label">' + result[i].label.msg + '</span>' +
                        '<span class="exam-title">' + result[i].title + '</span>' +
                        '</div>\n' +
                        '<img src="../../images/分割线.png" class="line"/>');
                }
                $("#exam-content-wrapper").show();
            },
            error : function () {
                layer.closeAll();
                layer.msg("请检查网络");
            }
        })
    }

    function searchBook() {
        $.ajax({
            url: serverIp + "search",
            type:"POST",
            data:{
                userId:userId,
                word:word,
                model:"study",
                part:"book",
                num:0,
                limit:3
            },

            success:function (result) {
                layer.closeAll();
                if(result.code === 1) {
                    console.log("从服务器获取数据失败");
                    return;
                }
                result = JSON.parse(result.data);
                if(result.length === 0)return;
                $("#book-content").html('');
                for(var i = 0; i < result.length; i++) {
                    $("#book-content").append(
                        '<div class="book-wrapper" onclick="readBook(\'' +result[i].id + '\')">\n' +
                        '    <div class="book-img-wrapper">\n' +
                        '        <img class="book-img" src="' + result[i].picUrl + '"/>\n' +
                        '    </div>\n' +
                        '    <div class="book-title">'+ result[i].title +'</div>\n' +
                        '    <div class="book-synopsis">'+ result[i].synopsis + '</span>\n' +
                        '    </div>\n' +
                        '    <div class="book-bottom">\n' +
                        '        <div class="book-author">'+ result[i].author + '</div>\n' +
                        '        <div class="book-label">'+ result[i].label.msg + '</div>\n' +
                        '    </div>\n' +
                        '    <img class="line" src="../../images/分割线.png"/>\n' +
                        '</div>');
                }
                $("#book-content-wrapper").show();
            },
            error : function () {
                layer.closeAll();
                layer.msg("请检查网络");
            }
        })
    }

    function searchVideo(part) {
        $.ajax({
            url: serverIp + "search",
            type:"POST",
            data:{
                userId:userId,
                word:word,
                model:"study",
                part:part,
                num:0,
                limit:3
            },

            success:function (result) {
                layer.closeAll();
                if(result.code === 1) {
                    console.log("从服务器获取数据失败");
                    return;
                }
                result = JSON.parse(result.data);
                if(result.length === 0)return;
                $("#" + part + "-content").html('');
                for (var i = 0; i < result.length; i++) {
                    $("#" + part + "-content").append(
                        '<div class="tv" onclick="readVideo(\'' + part + '\',\'' + result[i].id +  '\')">' +
                        '<div class="tv_image_div">' +
                        '<img class="tv_image" src="'+ result[i].picUrl + '"/>' +
                        '</div>' +
                        '<div class="tv_title">' +
                        '<span class="tv_title_text">' + result[i].title + '</span>' +
                        '</div>' +
                        '<div class="tv_character">' +
                        '<span class="tv_text">' + result[i].actor + '</span>' +
                        '</div>' +
                        '<div class="tv_synopsis">' +
                        '<span class="tv_text">' + result[i].synopsis + '</span>' +
                        '</div>' +
                        '<img class="line" src="../../images/分割线.png"/>' +
                        '</div>');
                }
                $("#" + part + "-content-wrapper").show();
            },
            error : function () {
                layer.closeAll();
                layer.msg("请检查网络");
            }
        })
    }

    function searchArticles() {
        document.getElementById('articles').innerHTML = "";
        $.ajax({
            url: _url_()+"/article/search",
            type:"POST",
            data:{
                str:word
            },
            success:function(result) {
                layer.closeAll();
                if (result.code == 0) {
                    result = result.data;
                    showList(result);
                    $("#articles").show();
                }
            },
            error:function(result) {
                layer.closeAll();
                layer.msg("请检查网络");
            }
        });
    }

    // 显示文章列表 参数为文章list
    function showList(result) {
        for (var i = 0; i < result.length; i++) {
            var articles = document.getElementById('articles').innerHTML;
            document.getElementById('articles').innerHTML = articles +
                '<div onclick="window.android.toArticle(' + '\'' + result[i].htmlUrl + '\', ' + result[i].id + ')" style="margin-top: -10px">'+
                '<div style="margin: 15px;">'+
                '<div class="text">'+
                '<p><span style="font-size: 15px;">' + result[i].title + '</span></p>'+
                '</div>'+
                '</div>'+
                '<div style="margin-top: -5px; margin-left: 15px; font-size:14px; color: #6C6C6C">'+
                '<p><span>' + result[i].type + '&nbsp; ' + result[i].date + '</span></p>'+
                '</div>'+
                '<div style="margin-top:5px;"><img style="width: 100%" src="../../images/首页/u58.png"/></div></div>';
        }
    }

    function getMore(model, part) {
        window.android.getMore(model, part, word);
    }

    function finish() {
        window.android.finish();
    }

    $("#input").bind("input propertychange",function(event){
        var word = $(".search-input").val();
        if(word === undefined || word.toString().length <= 0) {
            $("#exam-content-wrapper").hide();
            $("#book-content-wrapper").hide();
            $("#teleplay-content-wrapper").hide();
            $("#film-content-wrapper").hide();
            $("#variety-content-wrapper").hide();
            $("#documentary-content-wrapper").hide();
            $("#drama-content-wrapper").hide();
            $("#base-content-wrapper").hide();
            $("#word-model").show();
        }
    });

</script>
</html>
